<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.spring_plsql_sample.article.persistence.MyBatisArticleMapper">

    <resultMap id="articleResultMap" type="com.example.spring_plsql_sample.article.vo.ArticleVO">
        <result property="id" column="ID"/>
        <result property="title" column="TITLE"/>
        <result property="content" column="CONTENT"/>
        <result property="author" column="AUTHOR"/>
        <result property="createdAt" column="CREATED_AT"/>
        <result property="updatedAt" column="UPDATED_AT"/>
    </resultMap>

    <insert id="createArticle" parameterType="com.example.spring_plsql_sample.article.vo.ArticleVO" statementType="CALLABLE">
        {CALL SP_ARTICLE_CREATE(
            #{title, mode=IN, jdbcType=VARCHAR},
            #{content, mode=IN, jdbcType=VARCHAR},
            #{author, mode=IN, jdbcType=VARCHAR},
            #{id, mode=OUT, jdbcType=NUMERIC},
            #{createdAt, mode=OUT, jdbcType=TIMESTAMP},
            #{updatedAt, mode=OUT, jdbcType=TIMESTAMP}
        )}
    </insert>

    <select id="getAllArticles" statementType="CALLABLE" resultMap="articleResultMap">
        {CALL SP_ARTICLE_GET_ALL(
            #{cursor, mode=OUT, jdbcType=CURSOR, javaType=java.sql.ResultSet, resultMap=articleResultMap}
        )}
    </select>

    <select id="getArticleById" parameterType="map" statementType="CALLABLE" resultMap="articleResultMap">
        {CALL SP_ARTICLE_GET_BY_ID(
            #{id, mode=IN, jdbcType=NUMERIC},
            #{cursor, mode=OUT, jdbcType=CURSOR, javaType=java.sql.ResultSet, resultMap=articleResultMap}
        )}
    </select>

    <update id="updateArticle" parameterType="com.example.spring_plsql_sample.article.vo.ArticleVO"
            statementType="CALLABLE">
        {CALL SP_ARTICLE_UPDATE(
            #{id, mode=IN, jdbcType=NUMERIC},
            #{title, mode=IN, jdbcType=VARCHAR},
            #{content, mode=IN, jdbcType=VARCHAR},
            #{createdAt, mode=OUT, jdbcType=TIMESTAMP},
            #{updatedAt, mode=OUT, jdbcType=TIMESTAMP}
        )}
    </update>

    <delete id="deleteArticle" parameterType="long" statementType="CALLABLE">
        {CALL SP_ARTICLE_DELETE(
            #{id, mode=IN, jdbcType=NUMERIC}
        )}
    </delete>

</mapper>